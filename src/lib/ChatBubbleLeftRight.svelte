<script lang="ts">
  import { getContext } from 'svelte';

  type TitleType = {
    id?: string;
    title?: string;
  };
  
  type DescType = {
    id?: string;
    desc?: string;
  };
  
  interface BaseProps {
    size?: string;
    role?: string;
    color?: string;
    variation?: "solid" | "outline" | "mini" | "micro";
    strokeWidth?: string;
    withEvents?: boolean;
    onclick?: (event: MouseEvent) => void;
    onkeydown?: (event: KeyboardEvent) => void;
    onkeyup?: (event: KeyboardEvent) => void;
    class?: string;
  }
  
  interface CtxType extends BaseProps {}
  
  interface Props extends BaseProps{
    title?: TitleType;
    desc?: DescType;
    ariaLabel?: string;
  }
  
  const ctx: CtxType = getContext('iconCtx') ?? {};

  let { 
    size = ctx.size || '24', 
    role = ctx.role || 'img', 
    color = ctx.color || 'currentColor', 
    variation = ctx.variation || "outline",
    strokeWidth = ctx.strokeWidth || '1.5',
    withEvents = ctx.withEvents || false, 
    title = {}, 
    desc = {}, 
    class: classname, 
    ariaLabel = "chat bubble left right", 
    onclick, 
    onkeydown, 
    onkeyup,
    ...restProps 
  }: Props = $props();

  let ariaDescribedby = `${title.id || ''} ${desc.id || ''}`;
  let hasDescription = $state(false);
  let viewBox: string = $state(''); 

  function updateHasDescription() {
    hasDescription = !!(title.id || desc.id); 
  }
  updateHasDescription();

  $effect(() => {
    updateHasDescription();
 
    if (variation === 'mini') {
      size = size || "20";
      viewBox = '0 0 20 20';
    } else if (variation === 'micro'){
      size = size || "16";
      viewBox = '0 0 16 16';
    } else {
      size = size || "24";
      viewBox = '0 0 24 24';
    }
  })
  
</script>

{#if withEvents}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    {...restProps}
    {role}
    width={size}
    height={size}
    class={classname}
    fill="none"
    aria-label={ariaLabel}
    aria-describedby={hasDescription ? ariaDescribedby : undefined}
    {viewBox}
    stroke-width={strokeWidth}
    onclick={onclick}
    onkeydown={onkeydown}
    onkeyup={onkeyup}
  >
    {#if title.id && title.title}
      <title id="{title.id}">{title.title}</title>
    {/if}
    {#if desc.id && desc.desc}
      <desc id="{desc.id}">{desc.desc}</desc>
    {/if}
      {#if variation === 'outline'}
        <path d="M20.25 8.51104C21.1341 8.79549 21.75 9.6392 21.75 10.6082V14.8938C21.75 16.0304 20.9026 16.9943 19.7697 17.0867C19.4308 17.1144 19.0909 17.1386 18.75 17.1592V20.25L15.75 17.25C14.3963 17.25 13.0556 17.1948 11.7302 17.0866C11.4319 17.0623 11.1534 16.9775 10.9049 16.8451M20.25 8.51104C20.0986 8.46232 19.9393 8.43 19.7739 8.41628C18.4472 8.30616 17.1051 8.25 15.75 8.25C14.3948 8.25 13.0528 8.30616 11.7261 8.41627C10.595 8.51015 9.75 9.47323 9.75 10.6082V14.8937C9.75 15.731 10.2099 16.4746 10.9049 16.8451M20.25 8.51104V6.63731C20.25 5.01589 19.0983 3.61065 17.4903 3.40191C15.4478 3.13676 13.365 3 11.2503 3C9.13533 3 7.05233 3.13678 5.00963 3.40199C3.40173 3.61074 2.25 5.01598 2.25 6.63738V12.8626C2.25 14.484 3.40173 15.8893 5.00964 16.098C5.58661 16.1729 6.16679 16.2376 6.75 16.2918V21L10.9049 16.8451" stroke="{color}" stroke-width="{strokeWidth}" stroke-linecap="round" stroke-linejoin="round"/> 
      {:else if variation === 'mini'}
        <path d="M3.50491 2.36515C5.30269 2.1243 7.13702 2 9 2C10.863 2 12.6973 2.1243 14.4951 2.36515C15.7418 2.53218 16.6741 3.4733 16.9298 4.6333C16.7425 4.59823 16.5501 4.57486 16.3531 4.5641C15.5739 4.52154 14.7894 4.5 14 4.5C13.2106 4.5 12.4261 4.52154 11.6469 4.5641C9.22913 4.69615 7.5 6.72739 7.5 8.99794V11.2377C7.5 12.6511 8.17008 13.9726 9.26042 14.8002L6.28033 17.7803C6.06583 17.9948 5.74324 18.059 5.46299 17.9429C5.18273 17.8268 5 17.5533 5 17.25V13.8073C4.49897 13.7588 4.00056 13.7013 3.50493 13.6349C2.0334 13.4377 1 12.1622 1 10.7211V5.27886C1 3.83785 2.03337 2.5623 3.50491 2.36515Z" fill="{color}"/> <path d="M14 6C13.2379 6 12.4807 6.0208 11.7287 6.06187C10.1572 6.1477 9 7.47212 9 8.99794V11.2377C9 12.7565 10.1467 14.077 11.7102 14.1726C11.9238 14.1857 12.1379 14.1971 12.3524 14.2068C12.5526 14.216 12.7366 14.2973 12.8702 14.4309L15.2197 16.7803C15.4342 16.9948 15.7568 17.059 16.037 16.9429C16.3173 16.8268 16.5 16.5533 16.5 16.25V14.1795C17.9525 13.9847 19 12.7165 19 11.2648V8.99794C19 7.47212 17.8428 6.1477 16.2713 6.06187C15.5193 6.0208 14.7621 6 14 6Z" fill="{color}"/> 
      {:else if variation === 'micro'}
        <path d="M1 8.84861C1 9.84878 1.73847 10.7002 2.73405 10.7959C2.82262 10.8045 2.91127 10.8127 3 10.8207V13.25C3 13.5533 3.18273 13.8268 3.46299 13.9429C3.74324 14.059 4.06583 13.9948 4.28033 13.7803L6.10018 11.9605C5.72131 11.4012 5.5 10.7264 5.5 10V9C5.5 7.067 7.067 5.5 9 5.5H13V4.15148C13 3.15133 12.2615 2.29993 11.266 2.20415C9.86223 2.0691 8.43918 2 7 2C5.56082 2 4.13777 2.0691 2.734 2.20415C1.73845 2.29993 1 3.15133 1 4.15148V8.84861Z" fill="{color}"/> <path d="M7 9C7 7.89543 7.89543 7 9 7H13C14.1046 7 15 7.89543 15 9V10C15 11.1046 14.1046 12 13 12H12.75V13.25C12.75 13.5533 12.5673 13.8268 12.287 13.9429C12.0068 14.059 11.6842 13.9948 11.4697 13.7803L9.68934 12H9C7.89543 12 7 11.1046 7 10V9Z" fill="{color}"/> 
      {:else}
        <path d="M4.91307 2.65823C6.9877 2.38888 9.10296 2.25 11.2503 2.25C13.3974 2.25 15.5124 2.38885 17.5869 2.65815C19.5091 2.90769 20.8783 4.51937 20.9923 6.38495C20.6665 6.27614 20.3212 6.20396 19.96 6.17399C18.5715 6.05874 17.1673 6 15.75 6C14.3326 6 12.9285 6.05874 11.54 6.17398C9.1817 6.36971 7.5 8.36467 7.5 10.6082V14.8937C7.5 16.5844 8.45468 18.1326 9.9328 18.8779L7.28033 21.5303C7.06583 21.7448 6.74324 21.809 6.46299 21.6929C6.18273 21.5768 6 21.3033 6 21V16.9705C5.63649 16.9316 5.27417 16.8887 4.91308 16.8418C2.90466 16.581 1.5 14.8333 1.5 12.8626V6.63738C1.5 4.66672 2.90466 2.91899 4.91307 2.65823Z" fill="{color}"/> <path d="M15.75 7.5C14.3741 7.5 13.0114 7.55702 11.6641 7.66884C10.1248 7.7966 9 9.10282 9 10.6082V14.8937C9 16.4014 10.128 17.7083 11.6692 17.8341C12.9131 17.9357 14.17 17.9912 15.4384 17.999L18.2197 20.7803C18.4342 20.9948 18.7568 21.059 19.037 20.9429C19.3173 20.8268 19.5 20.5533 19.5 20.25V17.8601C19.6103 17.8518 19.7206 17.8432 19.8307 17.8342C21.372 17.7085 22.5 16.4015 22.5 14.8938V10.6082C22.5 9.10283 21.3752 7.79661 19.836 7.66885C18.4886 7.55702 17.1259 7.5 15.75 7.5Z" fill="{color}"/> 
      {/if}
  </svg>
{:else}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    {...restProps}
    {role}
    width={size}
    height={size}
    class={classname}
    fill="none"
    aria-label={ariaLabel}
    aria-describedby={hasDescription ? ariaDescribedby : undefined}
    {viewBox}
    stroke-width={strokeWidth}
  >
    {#if title.id && title.title}
      <title id="{title.id}">{title.title}</title>
    {/if}
    {#if desc.id && desc.desc}
      <desc id="{desc.id}">{desc.desc}</desc>
    {/if}
      {#if variation === 'outline'}
        <path d="M20.25 8.51104C21.1341 8.79549 21.75 9.6392 21.75 10.6082V14.8938C21.75 16.0304 20.9026 16.9943 19.7697 17.0867C19.4308 17.1144 19.0909 17.1386 18.75 17.1592V20.25L15.75 17.25C14.3963 17.25 13.0556 17.1948 11.7302 17.0866C11.4319 17.0623 11.1534 16.9775 10.9049 16.8451M20.25 8.51104C20.0986 8.46232 19.9393 8.43 19.7739 8.41628C18.4472 8.30616 17.1051 8.25 15.75 8.25C14.3948 8.25 13.0528 8.30616 11.7261 8.41627C10.595 8.51015 9.75 9.47323 9.75 10.6082V14.8937C9.75 15.731 10.2099 16.4746 10.9049 16.8451M20.25 8.51104V6.63731C20.25 5.01589 19.0983 3.61065 17.4903 3.40191C15.4478 3.13676 13.365 3 11.2503 3C9.13533 3 7.05233 3.13678 5.00963 3.40199C3.40173 3.61074 2.25 5.01598 2.25 6.63738V12.8626C2.25 14.484 3.40173 15.8893 5.00964 16.098C5.58661 16.1729 6.16679 16.2376 6.75 16.2918V21L10.9049 16.8451" stroke="{color}" stroke-width="{strokeWidth}" stroke-linecap="round" stroke-linejoin="round"/> 
      {:else if variation === 'mini'}
        <path d="M3.50491 2.36515C5.30269 2.1243 7.13702 2 9 2C10.863 2 12.6973 2.1243 14.4951 2.36515C15.7418 2.53218 16.6741 3.4733 16.9298 4.6333C16.7425 4.59823 16.5501 4.57486 16.3531 4.5641C15.5739 4.52154 14.7894 4.5 14 4.5C13.2106 4.5 12.4261 4.52154 11.6469 4.5641C9.22913 4.69615 7.5 6.72739 7.5 8.99794V11.2377C7.5 12.6511 8.17008 13.9726 9.26042 14.8002L6.28033 17.7803C6.06583 17.9948 5.74324 18.059 5.46299 17.9429C5.18273 17.8268 5 17.5533 5 17.25V13.8073C4.49897 13.7588 4.00056 13.7013 3.50493 13.6349C2.0334 13.4377 1 12.1622 1 10.7211V5.27886C1 3.83785 2.03337 2.5623 3.50491 2.36515Z" fill="{color}"/> <path d="M14 6C13.2379 6 12.4807 6.0208 11.7287 6.06187C10.1572 6.1477 9 7.47212 9 8.99794V11.2377C9 12.7565 10.1467 14.077 11.7102 14.1726C11.9238 14.1857 12.1379 14.1971 12.3524 14.2068C12.5526 14.216 12.7366 14.2973 12.8702 14.4309L15.2197 16.7803C15.4342 16.9948 15.7568 17.059 16.037 16.9429C16.3173 16.8268 16.5 16.5533 16.5 16.25V14.1795C17.9525 13.9847 19 12.7165 19 11.2648V8.99794C19 7.47212 17.8428 6.1477 16.2713 6.06187C15.5193 6.0208 14.7621 6 14 6Z" fill="{color}"/> 
      {:else if variation === 'micro'}
        <path d="M1 8.84861C1 9.84878 1.73847 10.7002 2.73405 10.7959C2.82262 10.8045 2.91127 10.8127 3 10.8207V13.25C3 13.5533 3.18273 13.8268 3.46299 13.9429C3.74324 14.059 4.06583 13.9948 4.28033 13.7803L6.10018 11.9605C5.72131 11.4012 5.5 10.7264 5.5 10V9C5.5 7.067 7.067 5.5 9 5.5H13V4.15148C13 3.15133 12.2615 2.29993 11.266 2.20415C9.86223 2.0691 8.43918 2 7 2C5.56082 2 4.13777 2.0691 2.734 2.20415C1.73845 2.29993 1 3.15133 1 4.15148V8.84861Z" fill="{color}"/> <path d="M7 9C7 7.89543 7.89543 7 9 7H13C14.1046 7 15 7.89543 15 9V10C15 11.1046 14.1046 12 13 12H12.75V13.25C12.75 13.5533 12.5673 13.8268 12.287 13.9429C12.0068 14.059 11.6842 13.9948 11.4697 13.7803L9.68934 12H9C7.89543 12 7 11.1046 7 10V9Z" fill="{color}"/> 
      {:else}
        <path d="M4.91307 2.65823C6.9877 2.38888 9.10296 2.25 11.2503 2.25C13.3974 2.25 15.5124 2.38885 17.5869 2.65815C19.5091 2.90769 20.8783 4.51937 20.9923 6.38495C20.6665 6.27614 20.3212 6.20396 19.96 6.17399C18.5715 6.05874 17.1673 6 15.75 6C14.3326 6 12.9285 6.05874 11.54 6.17398C9.1817 6.36971 7.5 8.36467 7.5 10.6082V14.8937C7.5 16.5844 8.45468 18.1326 9.9328 18.8779L7.28033 21.5303C7.06583 21.7448 6.74324 21.809 6.46299 21.6929C6.18273 21.5768 6 21.3033 6 21V16.9705C5.63649 16.9316 5.27417 16.8887 4.91308 16.8418C2.90466 16.581 1.5 14.8333 1.5 12.8626V6.63738C1.5 4.66672 2.90466 2.91899 4.91307 2.65823Z" fill="{color}"/> <path d="M15.75 7.5C14.3741 7.5 13.0114 7.55702 11.6641 7.66884C10.1248 7.7966 9 9.10282 9 10.6082V14.8937C9 16.4014 10.128 17.7083 11.6692 17.8341C12.9131 17.9357 14.17 17.9912 15.4384 17.999L18.2197 20.7803C18.4342 20.9948 18.7568 21.059 19.037 20.9429C19.3173 20.8268 19.5 20.5533 19.5 20.25V17.8601C19.6103 17.8518 19.7206 17.8432 19.8307 17.8342C21.372 17.7085 22.5 16.4015 22.5 14.8938V10.6082C22.5 9.10283 21.3752 7.79661 19.836 7.66885C18.4886 7.55702 17.1259 7.5 15.75 7.5Z" fill="{color}"/> 
      {/if}
  </svg>
{/if}


