<script lang="ts">
  import { getContext } from 'svelte';
  
  type TitleType = {
    id?: string;
    title?: string;
  };
  type DescType = {
    id?: string;
    desc?: string;
  };
  interface BaseProps {
    size?: string;
    role?: string;
    color?: string;
    variation?: "solid" | "outline" | "mini" | "micro";
    strokeWidth?: string;
    withEvents?: boolean;
    onclick?: (event: MouseEvent) => void;
    onkeydown?: (event: KeyboardEvent) => void;
    onkeyup?: (event: KeyboardEvent) => void;
    class?: string;
  }
  interface CtxType extends BaseProps {}
  const ctx: CtxType = getContext('iconCtx') ?? {};
  interface Props extends BaseProps{
    title?: TitleType;
    desc?: DescType;
    ariaLabel?: string;
  }
  
  let { 
    size = ctx.size || '24', 
    role = ctx.role || 'img', 
    color = ctx.color || 'currentColor', 
    variation = ctx.variation || "outline",
    strokeWidth = ctx.strokeWidth || '1.5',
    withEvents = ctx.withEvents || false, 
    title = {}, 
    desc = {}, 
    class: classname, 
    ariaLabel = "signal", 
    onclick, 
    onkeydown, 
    onkeyup,
    ...restProps 
  }: Props = $props();

  let ariaDescribedby = `${title.id || ''} ${desc.id || ''}`;
  let hasDescription = $state(false);
  let viewBox: string = $state(''); 

  function updateHasDescription() {
    // Double negation converts truthy values to true, falsy to false
    hasDescription = !!(title.id || desc.id); 
  }
  updateHasDescription();

  $effect(() => {
    updateHasDescription();
 
    if (variation === 'mini') {
      size = size || "20";
      viewBox = '0 0 20 20';
    } else if (variation === 'micro'){
      size = size || "16";
      viewBox = '0 0 16 16';
    } else {
      size = size || "24";
      viewBox = '0 0 24 24';
    }
  })
  
</script>

{#if withEvents}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    {...restProps}
    {role}
    width={size}
    height={size}
    class={classname}
    fill="none"
    aria-label={ariaLabel}
    aria-describedby={hasDescription ? ariaDescribedby : undefined}
    {viewBox}
    stroke-width={strokeWidth}
    onclick={onclick}
    onkeydown={onkeydown}
    onkeyup={onkeyup}
  >
    {#if title.id && title.title}
      <title id="{title.id}">{title.title}</title>
    {/if}
    {#if desc.id && desc.desc}
      <desc id="{desc.id}">{desc.desc}</desc>
    {/if}
      {#if variation === 'outline'}
        <path d="M9.34835 14.6517C7.88388 13.1872 7.88388 10.8128 9.34835 9.34835M14.6517 9.34835C16.1161 10.8128 16.1161 13.1872 14.6517 14.6517M7.22703 16.773C4.59099 14.1369 4.59099 9.86307 7.22703 7.22703M16.773 7.22703C19.409 9.86307 19.409 14.1369 16.773 16.773M5.10571 18.8943C1.2981 15.0867 1.2981 8.91333 5.10571 5.10571M18.8943 5.10571C22.7019 8.91333 22.7019 15.0867 18.8943 18.8943M12 12H12.0075V12.0075H12V12ZM12.375 12C12.375 12.2071 12.2071 12.375 12 12.375C11.7929 12.375 11.625 12.2071 11.625 12C11.625 11.7929 11.7929 11.625 12 11.625C12.2071 11.625 12.375 11.7929 12.375 12Z" stroke="{color}" stroke-width="{strokeWidth}" stroke-linecap="round" stroke-linejoin="round"/> 
      {:else if variation === 'mini'}
        <path d="M16.364 3.63605C16.0711 3.34316 15.5962 3.34316 15.3033 3.63605C15.0104 3.92895 15.0104 4.40382 15.3033 4.69671C18.2322 7.62564 18.2322 12.3744 15.3033 15.3033C15.0104 15.5962 15.0104 16.0711 15.3033 16.364C15.5962 16.6569 16.0711 16.6569 16.364 16.364C19.8787 12.8493 19.8787 7.15077 16.364 3.63605Z" fill="{color}"/> <path d="M4.6967 4.69671C4.98959 4.40382 4.98959 3.92895 4.6967 3.63605C4.40381 3.34316 3.92893 3.34316 3.63604 3.63605C0.12132 7.15077 0.12132 12.8493 3.63604 16.364C3.92893 16.6569 4.40381 16.6569 4.6967 16.364C4.98959 16.0711 4.98959 15.5962 4.6967 15.3033C1.76777 12.3744 1.76777 7.62564 4.6967 4.69671Z" fill="{color}"/> <path d="M12.4749 6.46448C12.7678 6.17159 13.2426 6.17159 13.5355 6.46448C15.4882 8.41711 15.4882 11.5829 13.5355 13.5356C13.2426 13.8284 12.7678 13.8284 12.4749 13.5356C12.182 13.2427 12.182 12.7678 12.4749 12.4749C13.8417 11.1081 13.8417 8.89198 12.4749 7.52515C12.182 7.23225 12.182 6.75738 12.4749 6.46448Z" fill="{color}"/> <path d="M7.52513 6.46448C7.81802 6.75738 7.81802 7.23225 7.52513 7.52515C6.15829 8.89198 6.15829 11.1081 7.52513 12.4749C7.81802 12.7678 7.81802 13.2427 7.52513 13.5356C7.23223 13.8284 6.75736 13.8284 6.46447 13.5356C4.51184 11.5829 4.51184 8.41711 6.46447 6.46448C6.75736 6.17159 7.23223 6.17159 7.52513 6.46448Z" fill="{color}"/> <path d="M11 10C11 10.5523 10.5523 11 10 11C9.44772 11 9 10.5523 9 10C9 9.44771 9.44772 9 10 9C10.5523 9 11 9.44771 11 10Z" fill="{color}"/> 
      {:else if variation === 'micro'}
        <path d="M9 7.99998C9 8.55227 8.55228 8.99998 8 8.99998C7.44772 8.99998 7 8.55227 7 7.99998C7 7.4477 7.44772 6.99998 8 6.99998C8.55228 6.99998 9 7.4477 9 7.99998Z" fill="{color}"/> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.67938 5.25995C9.97227 4.96705 10.4471 4.96705 10.74 5.25995C12.2533 6.77323 12.2533 9.22674 10.74 10.74C10.4471 11.0329 9.97227 11.0329 9.67938 10.74C9.38649 10.4471 9.38649 9.97226 9.67938 9.67936C10.6069 8.75187 10.6069 7.2481 9.67938 6.32061C9.38649 6.02771 9.38649 5.55284 9.67938 5.25995ZM6.32062 5.25995C6.61351 5.55284 6.61351 6.02771 6.32062 6.32061C5.39313 7.2481 5.39313 8.75187 6.32062 9.67936C6.61351 9.97226 6.61351 10.4471 6.32062 10.74C6.02773 11.0329 5.55285 11.0329 5.25996 10.74C3.74668 9.22674 3.74668 6.77323 5.25996 5.25995C5.55285 4.96705 6.02773 4.96705 6.32062 5.25995Z" fill="{color}"/> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.8891 3.05024C12.182 2.75734 12.6569 2.75734 12.9497 3.05024C15.6834 5.78391 15.6834 10.2161 12.9497 12.9497C12.6569 13.2426 12.182 13.2426 11.8891 12.9497C11.5962 12.6568 11.5962 12.182 11.8891 11.8891C14.037 9.74119 14.037 6.25878 11.8891 4.1109C11.5962 3.818 11.5962 3.34313 11.8891 3.05024ZM4.11091 3.05024C4.40381 3.34313 4.40381 3.818 4.11091 4.1109C1.96303 6.25878 1.96303 9.74119 4.11091 11.8891C4.40381 12.182 4.40381 12.6568 4.11091 12.9497C3.81802 13.2426 3.34315 13.2426 3.05025 12.9497C0.316583 10.2161 0.316582 5.78391 3.05025 3.05024C3.34315 2.75734 3.81802 2.75734 4.11091 3.05024Z" fill="{color}"/> 
      {:else}
        <path fill-rule="evenodd" clip-rule="evenodd" d="M5.63604 4.57538C5.92893 4.86828 5.92893 5.34315 5.63604 5.63604C2.12132 9.15076 2.12132 14.8492 5.63604 18.364C5.92893 18.6569 5.92893 19.1317 5.63604 19.4246C5.34315 19.7175 4.86827 19.7175 4.57538 19.4246C0.474874 15.3241 0.474873 8.67589 4.57538 4.57538C4.86827 4.28249 5.34315 4.28249 5.63604 4.57538ZM18.364 4.57538C18.6569 4.28249 19.1317 4.28249 19.4246 4.57538C23.5251 8.67589 23.5251 15.3241 19.4246 19.4246C19.1317 19.7175 18.6569 19.7175 18.364 19.4246C18.0711 19.1317 18.0711 18.6569 18.364 18.364C21.8787 14.8492 21.8787 9.15076 18.364 5.63604C18.0711 5.34315 18.0711 4.86828 18.364 4.57538ZM7.75736 6.6967C8.05025 6.9896 8.05025 7.46447 7.75736 7.75736C5.41421 10.1005 5.41421 13.8995 7.75736 16.2426C8.05025 16.5355 8.05025 17.0104 7.75736 17.3033C7.46447 17.5962 6.98959 17.5962 6.6967 17.3033C3.76777 14.3744 3.76777 9.62564 6.6967 6.6967C6.98959 6.40381 7.46447 6.40381 7.75736 6.6967ZM16.2426 6.6967C16.5355 6.40381 17.0104 6.40381 17.3033 6.6967C20.2322 9.62564 20.2322 14.3744 17.3033 17.3033C17.0104 17.5962 16.5355 17.5962 16.2426 17.3033C15.9497 17.0104 15.9497 16.5355 16.2426 16.2426C18.5858 13.8995 18.5858 10.1005 16.2426 7.75736C15.9497 7.46447 15.9497 6.9896 16.2426 6.6967ZM9.87868 8.81802C10.1716 9.11092 10.1716 9.58579 9.87868 9.87868C8.70711 11.0503 8.70711 12.9498 9.87868 14.1213C10.1716 14.4142 10.1716 14.8891 9.87868 15.182C9.58579 15.4749 9.11091 15.4749 8.81802 15.182C7.06066 13.4246 7.06066 10.5754 8.81802 8.81802C9.11091 8.52513 9.58579 8.52513 9.87868 8.81802ZM14.1213 8.81802C14.4142 8.52513 14.8891 8.52513 15.182 8.81802C16.9393 10.5754 16.9393 13.4246 15.182 15.182C14.8891 15.4749 14.4142 15.4749 14.1213 15.182C13.8284 14.8891 13.8284 14.4142 14.1213 14.1213C15.2929 12.9498 15.2929 11.0503 14.1213 9.87868C13.8284 9.58579 13.8284 9.11092 14.1213 8.81802ZM10.875 12C10.875 11.3787 11.3787 10.875 12 10.875C12.6213 10.875 13.125 11.3787 13.125 12C13.125 12.6213 12.6213 13.125 12 13.125C11.3787 13.125 10.875 12.6213 10.875 12Z" fill="{color}"/> 
      {/if}
  </svg>
{:else}
  <svg
    xmlns="http://www.w3.org/2000/svg"
    {...restProps}
    {role}
    width={size}
    height={size}
    class={classname}
    fill="none"
    aria-label={ariaLabel}
    aria-describedby={hasDescription ? ariaDescribedby : undefined}
    {viewBox}
    stroke-width={strokeWidth}
  >
    {#if title.id && title.title}
      <title id="{title.id}">{title.title}</title>
    {/if}
    {#if desc.id && desc.desc}
      <desc id="{desc.id}">{desc.desc}</desc>
    {/if}
      {#if variation === 'outline'}
        <path d="M9.34835 14.6517C7.88388 13.1872 7.88388 10.8128 9.34835 9.34835M14.6517 9.34835C16.1161 10.8128 16.1161 13.1872 14.6517 14.6517M7.22703 16.773C4.59099 14.1369 4.59099 9.86307 7.22703 7.22703M16.773 7.22703C19.409 9.86307 19.409 14.1369 16.773 16.773M5.10571 18.8943C1.2981 15.0867 1.2981 8.91333 5.10571 5.10571M18.8943 5.10571C22.7019 8.91333 22.7019 15.0867 18.8943 18.8943M12 12H12.0075V12.0075H12V12ZM12.375 12C12.375 12.2071 12.2071 12.375 12 12.375C11.7929 12.375 11.625 12.2071 11.625 12C11.625 11.7929 11.7929 11.625 12 11.625C12.2071 11.625 12.375 11.7929 12.375 12Z" stroke="{color}" stroke-width="{strokeWidth}" stroke-linecap="round" stroke-linejoin="round"/> 
      {:else if variation === 'mini'}
        <path d="M16.364 3.63605C16.0711 3.34316 15.5962 3.34316 15.3033 3.63605C15.0104 3.92895 15.0104 4.40382 15.3033 4.69671C18.2322 7.62564 18.2322 12.3744 15.3033 15.3033C15.0104 15.5962 15.0104 16.0711 15.3033 16.364C15.5962 16.6569 16.0711 16.6569 16.364 16.364C19.8787 12.8493 19.8787 7.15077 16.364 3.63605Z" fill="{color}"/> <path d="M4.6967 4.69671C4.98959 4.40382 4.98959 3.92895 4.6967 3.63605C4.40381 3.34316 3.92893 3.34316 3.63604 3.63605C0.12132 7.15077 0.12132 12.8493 3.63604 16.364C3.92893 16.6569 4.40381 16.6569 4.6967 16.364C4.98959 16.0711 4.98959 15.5962 4.6967 15.3033C1.76777 12.3744 1.76777 7.62564 4.6967 4.69671Z" fill="{color}"/> <path d="M12.4749 6.46448C12.7678 6.17159 13.2426 6.17159 13.5355 6.46448C15.4882 8.41711 15.4882 11.5829 13.5355 13.5356C13.2426 13.8284 12.7678 13.8284 12.4749 13.5356C12.182 13.2427 12.182 12.7678 12.4749 12.4749C13.8417 11.1081 13.8417 8.89198 12.4749 7.52515C12.182 7.23225 12.182 6.75738 12.4749 6.46448Z" fill="{color}"/> <path d="M7.52513 6.46448C7.81802 6.75738 7.81802 7.23225 7.52513 7.52515C6.15829 8.89198 6.15829 11.1081 7.52513 12.4749C7.81802 12.7678 7.81802 13.2427 7.52513 13.5356C7.23223 13.8284 6.75736 13.8284 6.46447 13.5356C4.51184 11.5829 4.51184 8.41711 6.46447 6.46448C6.75736 6.17159 7.23223 6.17159 7.52513 6.46448Z" fill="{color}"/> <path d="M11 10C11 10.5523 10.5523 11 10 11C9.44772 11 9 10.5523 9 10C9 9.44771 9.44772 9 10 9C10.5523 9 11 9.44771 11 10Z" fill="{color}"/> 
      {:else if variation === 'micro'}
        <path d="M9 7.99998C9 8.55227 8.55228 8.99998 8 8.99998C7.44772 8.99998 7 8.55227 7 7.99998C7 7.4477 7.44772 6.99998 8 6.99998C8.55228 6.99998 9 7.4477 9 7.99998Z" fill="{color}"/> <path fill-rule="evenodd" clip-rule="evenodd" d="M9.67938 5.25995C9.97227 4.96705 10.4471 4.96705 10.74 5.25995C12.2533 6.77323 12.2533 9.22674 10.74 10.74C10.4471 11.0329 9.97227 11.0329 9.67938 10.74C9.38649 10.4471 9.38649 9.97226 9.67938 9.67936C10.6069 8.75187 10.6069 7.2481 9.67938 6.32061C9.38649 6.02771 9.38649 5.55284 9.67938 5.25995ZM6.32062 5.25995C6.61351 5.55284 6.61351 6.02771 6.32062 6.32061C5.39313 7.2481 5.39313 8.75187 6.32062 9.67936C6.61351 9.97226 6.61351 10.4471 6.32062 10.74C6.02773 11.0329 5.55285 11.0329 5.25996 10.74C3.74668 9.22674 3.74668 6.77323 5.25996 5.25995C5.55285 4.96705 6.02773 4.96705 6.32062 5.25995Z" fill="{color}"/> <path fill-rule="evenodd" clip-rule="evenodd" d="M11.8891 3.05024C12.182 2.75734 12.6569 2.75734 12.9497 3.05024C15.6834 5.78391 15.6834 10.2161 12.9497 12.9497C12.6569 13.2426 12.182 13.2426 11.8891 12.9497C11.5962 12.6568 11.5962 12.182 11.8891 11.8891C14.037 9.74119 14.037 6.25878 11.8891 4.1109C11.5962 3.818 11.5962 3.34313 11.8891 3.05024ZM4.11091 3.05024C4.40381 3.34313 4.40381 3.818 4.11091 4.1109C1.96303 6.25878 1.96303 9.74119 4.11091 11.8891C4.40381 12.182 4.40381 12.6568 4.11091 12.9497C3.81802 13.2426 3.34315 13.2426 3.05025 12.9497C0.316583 10.2161 0.316582 5.78391 3.05025 3.05024C3.34315 2.75734 3.81802 2.75734 4.11091 3.05024Z" fill="{color}"/> 
      {:else}
        <path fill-rule="evenodd" clip-rule="evenodd" d="M5.63604 4.57538C5.92893 4.86828 5.92893 5.34315 5.63604 5.63604C2.12132 9.15076 2.12132 14.8492 5.63604 18.364C5.92893 18.6569 5.92893 19.1317 5.63604 19.4246C5.34315 19.7175 4.86827 19.7175 4.57538 19.4246C0.474874 15.3241 0.474873 8.67589 4.57538 4.57538C4.86827 4.28249 5.34315 4.28249 5.63604 4.57538ZM18.364 4.57538C18.6569 4.28249 19.1317 4.28249 19.4246 4.57538C23.5251 8.67589 23.5251 15.3241 19.4246 19.4246C19.1317 19.7175 18.6569 19.7175 18.364 19.4246C18.0711 19.1317 18.0711 18.6569 18.364 18.364C21.8787 14.8492 21.8787 9.15076 18.364 5.63604C18.0711 5.34315 18.0711 4.86828 18.364 4.57538ZM7.75736 6.6967C8.05025 6.9896 8.05025 7.46447 7.75736 7.75736C5.41421 10.1005 5.41421 13.8995 7.75736 16.2426C8.05025 16.5355 8.05025 17.0104 7.75736 17.3033C7.46447 17.5962 6.98959 17.5962 6.6967 17.3033C3.76777 14.3744 3.76777 9.62564 6.6967 6.6967C6.98959 6.40381 7.46447 6.40381 7.75736 6.6967ZM16.2426 6.6967C16.5355 6.40381 17.0104 6.40381 17.3033 6.6967C20.2322 9.62564 20.2322 14.3744 17.3033 17.3033C17.0104 17.5962 16.5355 17.5962 16.2426 17.3033C15.9497 17.0104 15.9497 16.5355 16.2426 16.2426C18.5858 13.8995 18.5858 10.1005 16.2426 7.75736C15.9497 7.46447 15.9497 6.9896 16.2426 6.6967ZM9.87868 8.81802C10.1716 9.11092 10.1716 9.58579 9.87868 9.87868C8.70711 11.0503 8.70711 12.9498 9.87868 14.1213C10.1716 14.4142 10.1716 14.8891 9.87868 15.182C9.58579 15.4749 9.11091 15.4749 8.81802 15.182C7.06066 13.4246 7.06066 10.5754 8.81802 8.81802C9.11091 8.52513 9.58579 8.52513 9.87868 8.81802ZM14.1213 8.81802C14.4142 8.52513 14.8891 8.52513 15.182 8.81802C16.9393 10.5754 16.9393 13.4246 15.182 15.182C14.8891 15.4749 14.4142 15.4749 14.1213 15.182C13.8284 14.8891 13.8284 14.4142 14.1213 14.1213C15.2929 12.9498 15.2929 11.0503 14.1213 9.87868C13.8284 9.58579 13.8284 9.11092 14.1213 8.81802ZM10.875 12C10.875 11.3787 11.3787 10.875 12 10.875C12.6213 10.875 13.125 11.3787 13.125 12C13.125 12.6213 12.6213 13.125 12 13.125C11.3787 13.125 10.875 12.6213 10.875 12Z" fill="{color}"/> 
      {/if}
  </svg>
{/if}


